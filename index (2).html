<html>
<head>

</head>
<body>
    <p id="prompt">Please log in</p>
    <form id="myForm" action ="https://mcval.herokuapp.com/log_in" method="POST">
        <label>Username</label>
        <input placeholder="username" type="text" />        
        <label>Password</label>
        <input type="password"/>
        <input type="submit">
    </form>

<script>
    document.addEventListener('submit',e=>{
        e.preventDefault();
        const formInput = e.target;
        let inputField=[...formInput.querySelectorAll('input')]
        let req= {
            "username":inputField[0].value,
            "password":inputField[1].value
        }
        fetch(formInput.action,{
             method:formInput.method,
             headers:{
                'Content-Type': 'application/json'
             },
             body:JSON.stringify(req),
         })
         .then(result=>result.json())
         .then(data=>{
             if(data.status==="good"){
                 formInput.reset();
                 formInput.remove();
                 document.getElementById("prompt").innerHTML="You are logged in";
                 document.getElementById("prompt").style.color='green';
                var button = document.createElement("button");
                button.innerHTML = "Log Out";
                button.setAttribute("id","log_out")
                var body = document.getElementsByTagName("body")[0];
                body.appendChild(button);
                button.addEventListener ("click", function() {
                fetch("https://mcval.herokuapp.com/log_out")
                .then(result=>result.json())
                .then(data=>{
                        document.getElementById("log_out").remove();
                        var body = document.getElementsByTagName("body")[0];
                        body.appendChild(formInput);
                        document.getElementById("prompt").innerHTML="Please log in";
                        document.getElementById("prompt").style.color='black';
                    })
                });
             }
             else{
                 formInput.reset();
                 document.getElementById("prompt").innerHTML="Incorrect username or password";
                 document.getElementById("prompt").style.color="red";
             }
         })
         .catch(err=>console.log(err));
        
    })
</script>
</body>
</html>
