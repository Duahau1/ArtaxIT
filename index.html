<html>
<head>
</head>
<body>
    <p id="prompt">Please log in</p>
    <form id="myForm" action="https://mcval.herokuapp.com/log_in" method="POST">
        <label>Username</label>
        <input placeholder="username" type="text" value="test8" />
        <label>Password</label>
        <input type="password" value="secured" />
        <input type="submit">
    </form>
    <script>
        //http://localhost:3000/
        //https://mcval.herokuapp.com
        /*
        Email ID:
            sb-ijm424933246@personal.example.com
        System Generated Password:
            iGf=i2q8
        */
        document.addEventListener('submit', e => {
            e.preventDefault();
            const formInput = e.target;
            let inputField = [...formInput.querySelectorAll('input')]
            let req = {
                "username": inputField[0].value,
                "password": inputField[1].value
            }
            fetch(formInput.action, {
                method: formInput.method,
                //THIS IS VERY IMPORTANT 
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(req),
            })
                .then(result => result.json())
                .then(data => {
                    if (data.status === "good") {
                        formInput.reset();
                        formInput.remove();
                        document.getElementById("prompt").innerHTML = "Logged in";
                        var button = document.createElement("button");
                        button.innerHTML = "Subscribe to careBasic";
                        button.setAttribute("id", "buy_paypal")
                        var body = document.getElementsByTagName("body")[0];
                        body.appendChild(button);
                        document.getElementById("buy_paypal").addEventListener('click', () => {
                            fetch("https://mcval.herokuapp.com/dashboard/subscription/createAgreement/1", {
                                credentials: 'include'

                            }).then(res => res.json()).then(res => window.location.href = res.url);
                        })
                    }
                    else {
                        formInput.reset();
                        document.getElementById("prompt").innerHTML = "Incorrect username or password";
                        document.getElementById("prompt").style.color = "red";
                    }
                })
                .catch(err => console.log(err));

        })

    </script>
</body>

</html>